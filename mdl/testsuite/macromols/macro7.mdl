dt = 1e-6
iterations=1250000
sprintf(seed_str,"%04g",SEED)

INCLUDE_FILE="parameters.mdl"

TIME_STEP = dt
ITERATIONS = iterations
GRID_DENSITY = 15000
ACCURATE_3D_REACTIONS = FALSE

PARTITION_X = [[-50.001 TO 50.001 STEP 100]]
PARTITION_Y = [[-50.001 TO 50.001 STEP 100]]
PARTITION_Z = [[-50.001 TO 50.001 STEP 100]]

DEFINE_MOLECULES {
  camkii_subunit  { DIFFUSION_CONSTANT_3D = 0 }
  camkii_subunitB { DIFFUSION_CONSTANT_3D = 0 }
  count_proxy_00  { DIFFUSION_CONSTANT_3D = 0 }
  count_proxy_01  { DIFFUSION_CONSTANT_3D = 0 }
  count_proxy_10  { DIFFUSION_CONSTANT_3D = 0 }
  count_proxy_11  { DIFFUSION_CONSTANT_3D = 0 }
  cam             { DIFFUSION_CONSTANT_3D = cam_diffusion }
}

DEFINE_COMPLEX_MOLECULE camkii {
  NUMBER_OF_SUBUNITS = [2, 6]
  SUBUNIT[1:2, 1:6] = count_proxy_00
  SUBUNIT[  1, 2:4] = camkii_subunit
  SUBUNIT[1:2, 1:3] = camkii_subunit
  SUBUNIT[1:2,   5] = camkii_subunit
  SUBUNIT[  1,   6] = camkii_subunitB
  SUBUNIT[  2,   6] = camkii_subunitB
  SUBUNIT[  2,   4] = camkii_subunitB
  SUBUNIT[1:2, 1:6] = camkii_subunit
  SHAPE {
    SUBUNIT[1, 1] = [-.10,  .0000,  .05]
    SUBUNIT[1, 2] = [ .05,  .0866,  .05]
    SUBUNIT[1, 3] = [ .05,  .0866,  .05]
    SUBUNIT[1, 4] = [ .10,  .0000,  .05]
    SUBUNIT[1, 5] = [ .05, -.0866,  .05]
    SUBUNIT[1, 6] = [-.05, -.0866,  .05]
    SUBUNIT[2, 1] = [-.10,  .0000, -.05]
    SUBUNIT[2, 2] = [-.05,  .0866, -.05]
    SUBUNIT[2, 3] = [ .05,  .0866, -.05]
    SUBUNIT[2, 4] = [ .10,  .0000, -.05]
    SUBUNIT[2, 5] = [ .05, -.0866, -.05]
    SUBUNIT[2, 6] = [-.05, -.0866, -.05]
  }
  SUBUNIT_RELATIONSHIPS {
    ring_negative = [ 0, -1]
    ring_positive = [ 0, +1]
    dimer_partner = [+1,  0]
  }
  RATE_RULES {
    coop_binding_rate {
      dimer_partner != camkii_subunit : fw_rate * TMP_spec_F
      DEFAULT : fw_rate
    }
    coop_unbinding_rate {
      dimer_partner != camkii_subunit : bw_rate * TMP_spec_B
      DEFAULT : bw_rate
    }
  }
}

DEFINE_SURFACE_CLASS transparent {
  TRANSPARENT = cam
}

/*
DEFINE_REACTIONS {
  (camkii_subunit) + cam <-> (camkii_subunitB)   [> COMPLEX_RATE camkii coop_binding_rate,
                                                  < COMPLEX_RATE camkii coop_unbinding_rate]
}
 */

mainbox OBJECT {
  b BOX {
    CORNERS = [ -60, -60, -60 ], [ 60, 60, 60 ]
  }
}

MODIFY_SURFACE_REGIONS {
  mainbox.b[ALL] { SURFACE_CLASS = transparent }
}

INSTANTIATE world OBJECT
{
  mainbox OBJECT mainbox {
  }

  rs1 RELEASE_SITE {
    SHAPE = world.mainbox.b[ALL]
    MOLECULE = camkii
    NUMBER_TO_RELEASE = num_complexes
  }

  rs2 RELEASE_SITE {
    SHAPE = SPHERICAL
    MOLECULE = cam
    LOCATION = [0.0, 0.0, 0.0]
    SITE_RADIUS = 0
    NUMBER_TO_RELEASE = num_cam
  }
}

VIZ_OUTPUT {
  MODE = DREAMM_V3_GROUPED
  FILENAME = "./viz_data/test_box"

  MOLECULES
  {
    NAME_LIST { ALL_MOLECULES }

    ITERATION_NUMBERS {
      POSITIONS @ [[0 TO 500 STEP 5], [200 TO 1000 STEP 100], [2000 TO 100000 STEP 1000], [200000 TO iterations STEP 100000]]
    }
  }

  MESHES
  {
    NAME_LIST { ALL_MESHES }
    ITERATION_NUMBERS {
      ALL_DATA @ [0]
    }
  }
}

REACTION_DATA_OUTPUT {
    ITERATION_LIST = [[0 TO 9999 STEP 100], [10000 TO 250000 STEP 10000], [250001 TO 1250000 STEP 1]]
/*
    {COUNT[count_proxy_00, WORLD]} => "./reaction_data/coop_m00." & seed_str
    {COUNT[count_proxy_01, WORLD]} => "./reaction_data/coop_m01." & seed_str
    {COUNT[count_proxy_10, WORLD]} => "./reaction_data/coop_m10." & seed_str
    {COUNT[count_proxy_11, WORLD]} => "./reaction_data/coop_m11." & seed_str
 */
    {COUNT[SUBUNIT(camkii:camkii_subunit{dimer_partner==camkii_subunit}), WORLD]} => "./reaction_data/coop_m00." & seed_str
    {COUNT[SUBUNIT(camkii:camkii_subunit{dimer_partner!=camkii_subunit}), WORLD]} => "./reaction_data/coop_m01." & seed_str
    {COUNT[SUBUNIT(camkii:camkii_subunitB{dimer_partner==camkii_subunit}), WORLD]} => "./reaction_data/coop_m10." & seed_str
    {COUNT[SUBUNIT(camkii:camkii_subunitB{dimer_partner!=camkii_subunit}), WORLD]} => "./reaction_data/coop_m11." & seed_str
    {COUNT[cam, WORLD]} => "./reaction_data/coop_cam." & seed_str
}
